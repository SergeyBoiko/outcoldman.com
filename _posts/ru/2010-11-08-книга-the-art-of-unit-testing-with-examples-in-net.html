---
layout: post
title: "Книга The art of Unit Testing with Examples in .NET"
date: 2010-11-08 09:00:00
categories: ru
tags: [.NET, TDD, Mock, nUnit, Book Review, Manning, Moq]
alias: ru/blog/show/258
---
<p><a href="http://www.manning.com/osherove/"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 10px; display: inline; float: left; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="osherove_cover" border="0" alt="osherove_cover" align="left" src="{{ site.url }}/library/2010/11/07/osherove_cover_095490E3.jpg" width="160" height="196" /></a>Первый раз достаточно близко я познакомился с тестированием лет 5-6 назад, как раз начало моей карьеры. Тогда, я помню, мне рассказывали про покрытие кода тестами. Причем никаких Unit тестов меня не просили писать, просто говорили: “вот видишь if с тремя условиями, который ты написал, ты должен проверить все эти три условия”. Подразумевалось, что я, после того как напишу код, должен его проанализировать, и полностью протестировать обычным проходом по интерфейсу приложения. Как вам? Со временем знания в тестировании у меня немного выросли, я немного научился писать тесты. Я до сих пор не видел и не участвовал ни в одном живом проекте, написанным при помощи <a href="http://en.wikipedia.org/wiki/Test-driven_development" target="_blank">Test Driven Development (TDD)</a> подхода. Основа моих знаний была в подглядывании того, как делают это коллеги в предыдущей моей конторе, чтении статей (например, у Алесандра Бындю была отличная статья “<a href="http://habrahabr.ru/blogs/tdd/82842/" target="_blank">TDD для начинающих. Ответы на популярные вопросы</a>”), просмотра пару сринкастов. Я решил покончить с безграмотностью и проникнуться темой, для этого я сел за прочтение книги <a href="http://www.manning.com/osherove/" target="_blank">The art of Unit Testing with Examples in .NET</a>. Притом, что в текущей конторе? можно сказать, что тесты пишу только я для своего кода. Нужно быть образцом.</p>    <p>Эта книга написана уже, примерно, полтора года назад. Выбрал я ее не случайно, ее <a href="http://habrahabr.ru/blogs/tdd/82842/#comment_2466620" target="_blank">рекомендуют даже php программисты</a>, хоть большинство примеров у нее написаны на языке C#. А так как я видел достаточно разных рекомендаций для прочтения именно этой книги, я и решил начать с нее, чтобы покончить с безграмотностью. </p>  <p>Автор этой книги <a href="http://osherove.com/">Roy Osherove</a> достаточно известный <a href="http://weblogs.asp.net/rosherove/" target="_blank">блоггер</a>, так же он ведет мастер-классы по TDD, бывает работает консультантом для контор, которые хотят применить TDD у себя в проектах (и об этом он не раз пишет в этой книге, приводя удачные и не удачные примеры внедрения методологии). Работает главным архитектором в компании <a href="http://typemock.com/">Typemock</a>, которая выпускает платные инструменты для более удобного написания тестов и анализа кода. </p>  <p>Книга, в принципе, будет полезна разработчикам любых платформ и языков. В примерах большего всего используется C#, как подопытный язык (есть немного кода на Java), <a href="http://www.nunit.org/">NUnit</a> как фреймворк для написания Unit тестов, и <a href="http://ayende.com/projects/rhino-mocks.aspx">Rhino Mocks</a> фреймворк для использования Mock и Stub объектов в Unit тестах (кстати, раньше не знал, что это разные вещи, знал только Mock объекты). Для остальных платформ и языков можно будет использовать, наверное, только теорию, которой в книге предостаточно. Либо если есть похожие фремворки для вашей платформы, то вы сами сможете ознакомиться с ними и перевести код примеров на них. По крайней мере, я знаком только с Moq фреймворком, но понять синтаксис Rhino Mocks для меня не составило трудностей. </p>  <p>Итак, о чем же сама книга? Как всегда <a href="http://www.manning.com/osherove/">на официальном сайте книги</a> есть возможность скачать пару глав, чтобы начать знакомиться с книгой: для того чтобы оценить подходит она вам или нет. На сколько я знаю, ее не переводили на русский язык, а так как времени прошло достаточно с момента выхода, то, скорее всего, и не переведут. Начинается книга, как и любая другая с глав “Hello world!”, о том, что нужно, чтобы писать тесты, какие инструменты, ну и пишется первый тест. Дальше достаточно бегло описываются фреймворки, которые автор будет использовать в примерах: NUnit и Rhino Mocks. Упор на Rhino Mocks, на сколько я понял, автор сделал потому, что в его блоге он собрал когда-то статистику, что этот фреймворк используют больше остальных. Мне кажется, что ситуация сейчас поменялась, и более популярный фремворк все-таки сейчас - это <a href="http://code.google.com/p/moq/">Moq</a>. Ну а NUnit остается все таким же популярным фреймворком для тестирования. Одно время я переходил на MbUnit, потому что там было больше возможностей, но NUnit на данный момент хорошо подтянулся и догнал конкурента. </p>  <p>Чем дальше, тем книга становится все более интереснее. Достаточно подробно описываются принципы написания тестов, как их нужно оформлять, и главное – это то, что приводятся антипаттерны, которые я сразу узнал в своем коде (нужно совершенствоваться, теперь знаю куда). </p>  <p>Так же я получил ответ на свой давний вопрос. Когда-то я написал статью <a href="/ru/blog/show/173">Тестирование NHibernate приложений на примере MbUnit</a>, и тогда я получил один из <a href="http://outcoldman.livejournal.com/47289.html?thread=114105#t114105">комментариев</a>:</p>  <blockquote>У меня вот вопрос. А зачем? Зачем тестировать ORM? Собсно весь кусок взаимодействия с ORM выносится в отдельный класс(отдельные классы), и используется какой-нибудь IoC-контейнер.    <br />Что конкретно вы тестируете в ORM то? Маппинги? Запросы? </blockquote>  <p>Там у меня был немного специфический случай, потому я <a href="http://outcoldman.livejournal.com/47289.html?thread=114361#t114361">выкрутился</a> красиво, что, вроде, нужно было. Хотя я не понял, а почему нет: это мой интеграционный тест, я проверяю, что структура базы соответствуют маппингам, маппинг соответствует классам, если использую специальные запросы, то тестирую и их. Не раз спасало. В общем, я не знал, что ответить. В книге я получил ответ на свой вопрос – это полезно и нужно, автор тоже тестирует слой доступа к данным, и приводит аргументы зачем это.</p>  <p>Помимо того, как правильно писать тесты, в книге найдете информацию о том, как внедрить TDD практику у себя в конторе, как сделать написание тестов более эффективнее, как работать с Legacy кодом (а это считай очень важно, когда вводишь TDD для существующего проекта). И основное – это ответы на самые распространенные вопросы, на которые нужно отвечать, когда ты становишься тем человеком, который решил внедрить TDD в команде (вопросы связанные с временем, деньгами, знаниями и остальным). Я пытался как-то объяснить своим новым коллегам это, мне покивали, но доводы были не сильными. </p>  <p>Так же в книге есть обзор большого количества фремворков, которые могут пригодиться для тестирования. Среди которых, понятное дело, есть и платные фреймворки, написанные компанией <a href="http://typemock.com/">Typemock</a>, где работает автор.</p>  <p>Рекомендую книгу всем конторам, которые практикуют TDD у себя, и которые просто пишут тесты к своему коду (это мой случай), да в общем всем конторам. И моя рекомендация к лидам и менеджерам, не говорите “Пишите тесты”, а прочитайте книгу сами, либо попросите сотрудников, потом проведите тренинги, и все изменится. Мне кажется – это очень важная часть разработки. Я написал уже много тестов, но после прочтения книги понял, что их можно было написать намного более правильно и понятнее. Книга содержит отличные рекомендации. Не могу сказать, что она содержит ответы на все вопросы, и не могу сказать, что согласен с книгой во всех деталях, но то, что книгу стоило прочесть – это точно.</p>
