---
layout: post
title: "Когда нужно сделать PDF документ"
date: 2009-04-10 10:53:00
categories: ru
tags: [ASP.NET, .NET, C#, PDF, Reports, XML, XSLT]
alias: ru/blog/show/135
---
<p>Если перед Вами стоит задача - создавать простенькие (или не совсем) pdf документы в вашем приложении - это могут быть и отчеты и рецепты, ну либо вы захотите печатать так информацию о ваших объектах, то для решения этой задачи можно воспользоваться, к примеру, установленным OpenOffice и его возможностями (это тяжеловестно), а можно библиотекой <a href="http://sourceforge.net/projects/itextsharp/">iTextSharp </a>(Free C#-PDF library), вот про это я и хочу поведать небольшой пример, при помощи которого я создам такой вот документ:</p>   

<p><a href="/library/images/01/0000011.jpeg"><img width="640" height="454" border="0" alt="" src="/library/images/01/0000011.jpeg" /></a></p>    

<p>Способов создания pdf документов при помощи данной библиотеки множество. Мне больше всего понравился способ описания при помощи <a href="http://itextsharp.sourceforge.net/tutorial/ch07.html">xml документа</a>. Создавать такой xml я решил&nbsp; xslt преобразованием, а данные подсовывать xml-документом.</p>   

<p>Наши данные будут выглядить вот так:</p>   

<div id="codeSnippetWrapper" style="background-color: #f4f4f4;color: black;font-family: 'Courier New', Courier, Monospace;	font-size: 9pt; line-height: 12pt; border: solid 1px silver; cursor: text; margin: 20px 0px 10px 0px; overflow: auto; padding: 4px; width: 97.5%; direction: ltr; text-align: left;"><div id="codeSnippet" >
<pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"><span style="color: #0000ff;">&lt;?</span><span style="color: #800000;">xml</span> <span style="color: #ff0000;">version</span><span style="color: #0000ff;">="1.0"</span> <span style="color: #ff0000;">encoding</span><span style="color: #0000ff;">="utf-8"</span> ?<span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Profile</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">FirstName</span><span style="color: #0000ff;">&gt;</span>Иван<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">FirstName</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">SecondName</span><span style="color: #0000ff;">&gt;</span>Иванович<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">SecondName</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">LastName</span><span style="color: #0000ff;">&gt;</span>Иванов<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">LastName</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Subtexts</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Text</span><span style="color: #0000ff;">&gt;</span>Какой то непонятный текст. Какой то непонятный текст. Какой то непонятный текст. Какой то непонятный текст.<br/> Какой то непонятный текст. Какой то непонятный текст. Какой то непонятный текст. Какой то непонятный текст.<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Text</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Subtexts</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Subtexts</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Text</span><span style="color: #0000ff;">&gt;</span>Другой непонятный текст. Другой непонятный текст. Другой непонятный текст. Другой непонятный текст. Другой непонятный текст. <br/> Другой непонятный текст. Другой непонятный текст. Другой непонятный текст. Другой непонятный текст.<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Text</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Subtexts</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Profile</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--></div></div>

<p>
Далее нам необходимо создавать xml для pdf (скажу что ссылка на iText.dtd схему в документе tutorial битая, верную ссылку я привожу внизу), как я и сказал выше для этого мы напишем <a href="http://www.w3.org/TR/xslt">xslt преобразование</a>:</p>    

<div id="codeSnippetWrapper" style="background-color: #f4f4f4;color: black;font-family: 'Courier New', Courier, Monospace;	font-size: 9pt; line-height: 12pt; border: solid 1px silver; cursor: text; margin: 20px 0px 10px 0px; overflow: auto; padding: 4px; width: 97.5%; direction: ltr; text-align: left;"><div id="codeSnippet" >
<pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"><span style="color: #0000ff;">&lt;?</span><span style="color: #800000;">xml</span> <span style="color: #ff0000;">version</span><span style="color: #0000ff;">="1.0"</span> <span style="color: #ff0000;">encoding</span><span style="color: #0000ff;">="utf-8"</span>?<span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">xsl:stylesheet</span> <span style="color: #ff0000;">version</span><span style="color: #0000ff;">="1.0"</span> <span style="color: #ff0000;">xmlns:xsl</span><span style="color: #0000ff;">="http://www.w3.org/1999/XSL/Transform"</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #ff0000;">xmlns:msxsl</span><span style="color: #0000ff;">="urn:schemas-microsoft-com:xslt"</span> <span style="color: #ff0000;">exclude-result-prefixes</span><span style="color: #0000ff;">="msxsl"</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">xsl:param</span> <span style="color: #ff0000;">name</span><span style="color: #0000ff;">="picturePath"</span><span style="color: #0000ff;">/&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">xsl:output</span> <span style="color: #ff0000;">method</span><span style="color: #0000ff;">="xml"</span> <span style="color: #ff0000;">indent</span><span style="color: #0000ff;">="yes"</span><span style="color: #0000ff;">/&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">xsl:template</span> <span style="color: #ff0000;">match</span><span style="color: #0000ff;">="/Profile"</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">itext</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">paragraph</span> <span style="color: #ff0000;">align</span><span style="color: #0000ff;">="Center"</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">phrase</span> <span style="color: #ff0000;">fontstyle</span><span style="color: #0000ff;">="bold"</span> <span style="color: #ff0000;">size</span><span style="color: #0000ff;">="16.0"</span> <span style="color: #0000ff;">&gt;</span>Информация о пользователе<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">phrase</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">paragraph</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">&nbsp;</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">image</span> <span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">xsl:attribute</span> <span style="color: #ff0000;">name</span><span style="color: #0000ff;">="url"</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">xsl:value-of</span> <span style="color: #ff0000;">select</span><span style="color: #0000ff;">="$picturePath"</span><span style="color: #0000ff;">/&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">xsl:attribute</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">image</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">table</span> <span style="color: #ff0000;">width</span><span style="color: #0000ff;">="100%"</span> <span style="color: #ff0000;">columns</span><span style="color: #0000ff;">="3"</span> <span style="color: #ff0000;">cellpadding</span><span style="color: #0000ff;">="1"</span> <span style="color: #ff0000;">cellspacing</span><span style="color: #0000ff;">="1"</span> <span style="color: #ff0000;">borderwidth</span><span style="color: #0000ff;">="0.5"</span> <span style="color: #ff0000;">red</span><span style="color: #0000ff;">="0"</span> </pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">       <span style="color: #ff0000;">green</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">blue</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">left</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">right</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">top</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">bottom</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">widths</span><span style="color: #0000ff;">="33;33;33"</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">row</span> <span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">cell</span> <span style="color: #ff0000;">borderwidth</span><span style="color: #0000ff;">="0.5"</span> <span style="color: #ff0000;">red</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">green</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">blue</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">left</span><span style="color: #0000ff;">="false"</span> </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">        <span style="color: #ff0000;">right</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">top</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">bottom</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">header</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">horizontalalign</span><span style="color: #0000ff;">="Center"</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">phrase</span> <span style="color: #ff0000;">size</span><span style="color: #0000ff;">="10.0"</span> <span style="color: #0000ff;">&gt;</span>Фамилия<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">phrase</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">cell</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">cell</span> <span style="color: #ff0000;">borderwidth</span><span style="color: #0000ff;">="0.5"</span> <span style="color: #ff0000;">red</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">green</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">blue</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">left</span><span style="color: #0000ff;">="false"</span> </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">        <span style="color: #ff0000;">right</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">top</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">bottom</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">header</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">horizontalalign</span><span style="color: #0000ff;">="Center"</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">phrase</span> <span style="color: #ff0000;">size</span><span style="color: #0000ff;">="10.0"</span> <span style="color: #0000ff;">&gt;</span>Имя<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">phrase</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">cell</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">cell</span> <span style="color: #ff0000;">borderwidth</span><span style="color: #0000ff;">="0.5"</span> <span style="color: #ff0000;">red</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">green</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">blue</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">left</span><span style="color: #0000ff;">="false"</span> </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">        <span style="color: #ff0000;">right</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">top</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">bottom</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">header</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">horizontalalign</span><span style="color: #0000ff;">="Center"</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">phrase</span> <span style="color: #ff0000;">size</span><span style="color: #0000ff;">="10.0"</span> <span style="color: #0000ff;">&gt;</span>Отчество<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">phrase</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">cell</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">row</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">row</span> <span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">cell</span> <span style="color: #ff0000;">borderwidth</span><span style="color: #0000ff;">="0.5"</span> <span style="color: #ff0000;">red</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">green</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">blue</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">left</span><span style="color: #0000ff;">="false"</span> </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">        <span style="color: #ff0000;">right</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">top</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">bottom</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">header</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">horizontalalign</span><span style="color: #0000ff;">="Left"</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">phrase</span> <span style="color: #ff0000;">size</span><span style="color: #0000ff;">="10.0"</span> <span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">xsl:value-of</span> <span style="color: #ff0000;">select</span><span style="color: #0000ff;">="FirstName"</span><span style="color: #0000ff;">/&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">phrase</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">cell</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">cell</span> <span style="color: #ff0000;">borderwidth</span><span style="color: #0000ff;">="0.5"</span> <span style="color: #ff0000;">red</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">green</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">blue</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">left</span><span style="color: #0000ff;">="false"</span> </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">        <span style="color: #ff0000;">right</span><span style="color: #0000ff;">="true"</span> <span style="color: #ff0000;">top</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">bottom</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">header</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">horizontalalign</span><span style="color: #0000ff;">="Left"</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">phrase</span> <span style="color: #ff0000;">size</span><span style="color: #0000ff;">="10.0"</span> <span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">xsl:value-of</span> <span style="color: #ff0000;">select</span><span style="color: #0000ff;">="SecondName"</span><span style="color: #0000ff;">/&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">phrase</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">cell</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">cell</span> <span style="color: #ff0000;">borderwidth</span><span style="color: #0000ff;">="0.5"</span> <span style="color: #ff0000;">red</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">green</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">blue</span><span style="color: #0000ff;">="0"</span> <span style="color: #ff0000;">left</span><span style="color: #0000ff;">="false"</span> </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">        <span style="color: #ff0000;">right</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">top</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">bottom</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">header</span><span style="color: #0000ff;">="false"</span> <span style="color: #ff0000;">horizontalalign</span><span style="color: #0000ff;">="Left"</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">phrase</span> <span style="color: #ff0000;">size</span><span style="color: #0000ff;">="10.0"</span> <span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">       <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">xsl:value-of</span> <span style="color: #ff0000;">select</span><span style="color: #0000ff;">="LastName"</span><span style="color: #0000ff;">/&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">phrase</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">cell</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">row</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">table</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">&nbsp;</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">xsl:apply-templates</span> <span style="color: #ff0000;">select</span><span style="color: #0000ff;">="Subtexts"</span><span style="color: #0000ff;">/&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">       </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">itext</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">xsl:template</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">&nbsp;</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">xsl:template</span> <span style="color: #ff0000;">match</span><span style="color: #0000ff;">="Subtexts"</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">paragraph</span> <span style="color: #ff0000;">align</span><span style="color: #0000ff;">="Justify"</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">   <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">phrase</span> <span style="color: #ff0000;">size</span><span style="color: #0000ff;">="14.0"</span> <span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">xsl:value-of</span> <span style="color: #ff0000;">select</span><span style="color: #0000ff;">="Text"</span><span style="color: #0000ff;">/&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">   <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">phrase</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">paragraph</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">newline</span><span style="color: #0000ff;">/&gt;</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">xsl:template</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"> </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">xsl:stylesheet</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--></div></div>

<p>
По мне так схему описания они выбрали не самую удачную, уж слишком получается громозкий код для небольшого pdf документа. Так, очень не привычно, описывать цвета red green и blue отдельно друг от друга, уж можно было бы их сделать в HEX записи. Как видно в xslt схеме - в документе есть параметр, который указывает на путь картинки, которая вставится в наш pdf документ, так же там описывается при помощи схемы таблица, состоящая из 3х столбцов и пару параграфов.</p>  

<p>Следующий шаг: описываем  весь код, который будет возвращать нам массив байт нашего pdf документа, комментариями я попытался описать всю последовательность действий:</p>   

<div id="codeSnippetWrapper" style="background-color: #f4f4f4;color: black;font-family: 'Courier New', Courier, Monospace;	font-size: 9pt; line-height: 12pt; border: solid 1px silver; cursor: text; margin: 20px 0px 10px 0px; overflow: auto; padding: 4px; width: 97.5%; direction: ltr; text-align: left;"><div id="codeSnippet" >
<pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">byte</span>[] GetPdfRaw()</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">{</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  XmlDocument doc = <span style="color: #0000ff;">new</span> XmlDocument();</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #008000;">//Загружаем данные их xml файла</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  doc.Load(MapPath(<span style="color: #006080;">@"~\Resources\UserProfile.xml"</span>));</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  XslCompiledTransform xslTransform = <span style="color: #0000ff;">new</span> XslCompiledTransform();</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #008000;">//Загружаем схему XSLT преобразований</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  xslTransform.Load(MapPath(<span style="color: #006080;">@"~\Resources\ReportProcessor.xslt"</span>));</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  XsltArgumentList list = <span style="color: #0000ff;">new</span> XsltArgumentList();</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #008000;">//Записываем в параметры схемы путь до картинки</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  list.AddParam(<span style="color: #006080;">"picturePath"</span>, <span style="color: #0000ff;">string</span>.Empty, MapPath(<span style="color: #006080;">@"~\Resources\Toco.jpg"</span>));</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #008000;">//Создаем поток в памяти, куда будет писаться наша xml схема для pdf документа</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #0000ff;">using</span> (MemoryStream stream = <span style="color: #0000ff;">new</span> MemoryStream())</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  {</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #008000;">//Создаем xml схему нашего pdf документа</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    xslTransform.Transform(doc, list, stream);</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">&nbsp;</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #008000;">//Основной Font для pdf документа</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    BaseFont baseFont = BaseFont.CreateFont(Environment.ExpandEnvironmentVariables(<span style="color: #006080;">@"%systemroot%\fonts\Tahoma.TTF"</span>),</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">              <span style="color: #006080;">"CP1251"</span>, BaseFont.EMBEDDED);</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">&nbsp;</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #008000;">//Создаем PDF документ</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    Document document = <span style="color: #0000ff;">new</span> Document();</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">using</span> (MemoryStream pdfStream = <span style="color: #0000ff;">new</span> MemoryStream())</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    {</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      PdfWriter.GetInstance(document, pdfStream);</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      XmlDocument d = <span style="color: #0000ff;">new</span> XmlDocument();</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #0000ff;">string</span> str = Encoding.UTF8.GetString(stream.ToArray()).Substring(1);</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      d.LoadXml(str);</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #008000;">//Определяем преобразователь из xml в pdf</span></pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      ITextHandler h = <span style="color: #0000ff;">new</span> ITextHandler(document) {DefaultFont = baseFont};</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      h.Parse(d);</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #008000;">//Возвращаем полученный pdf файл в формате byte[]</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">      <span style="color: #0000ff;">return</span> pdfStream.ToArray();</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    }</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  }</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">}</pre><!--CRLF--></div></div>

<p>
Хочу обратить внимание на определение baseFont и установки его в качестве деволтного шрифта для ITextHandler. Если данную процедуру не выполнить, тогда кирилика отображаться не будет. Данный подход позволяет отображать кириллику, но не дает нам возможности использовать несколько шрифтов в одному документе. В их коде (благо есть исходный код) они всегда берут codepage 1252 (прямо жестко зашито в код), потому, если вам необходимо будет использовать несколько шрифтов в одном документе, тогда исправляйте код и собирайте сами библиотеку, либо не используйте xml в качестве исходника данных (но не факт что проблема только в ITextHandler).</p>  

<p>Еще очень сильно интересует, почему они классы иногда называют с буквы I, в c# так называют интерфейсы. Конечно, я понимаю, что библиотека портирована с java, но все же - меня это ввело сначала в ступор...</p>   

<p>Последнее это вывод pdf документа в Responce страницы (если у вас ASP.NET приложение как у меня)</p>  

<div id="codeSnippetWrapper" style="background-color: #f4f4f4;color: black;font-family: 'Courier New', Courier, Monospace;	font-size: 9pt; line-height: 12pt; border: solid 1px silver; cursor: text; margin: 20px 0px 10px 0px; overflow: auto; padding: 4px; width: 97.5%; direction: ltr; text-align: left;"><div id="codeSnippet" >
<pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">override</span> <span style="color: #0000ff;">void</span> OnLoad(EventArgs e)</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">{</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #008000;">//Записываем в Response pdf файл, указываем его MIME тип и имя файла</span></pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  HttpContext.Current.Response.Clear();</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  HttpContext.Current.Response.ContentType = <span style="color: #006080;">"application/pdf"</span>;</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  HttpContext.Current.Response.AddHeader(<span style="color: #006080;">"Content-Disposition"</span>, <span style="color: #0000ff;">string</span>.Format(<span style="color: #006080;">"attachment;filename=\"{0}\""</span>, <span style="color: #006080;">"report.pdf"</span>));</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  <span style="color: #0000ff;">byte</span>[] pdfRaw = GetPdfRaw();</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">  HttpContext.Current.Response.OutputStream.Write(pdfRaw, 0, pdfRaw.Length);</pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">}</pre><!--CRLF--></div></div>
<h4> Скачать пример:
<a href="/library/content/01/ASPNETPdfSample.zip">ASPNETPdfSample.zip</a> (для работы примера необходимо так же скачать библиотеку itextsharp, пример использует версию 4.1.2.0)</h4>      

<p>Ссылки по теме:</p>    

<ul><li><a href="http://sourceforge.net/projects/itextsharp/">iTextSharp на SourceForge</a></li><li><a href="http://itextsharp.sourceforge.net/tutorial/">iTextSharp Tutorial</a></li><li><a href="http://itext.sourceforge.net/itext.dtd">iText.dtd</a> (xml схема)</li></ul>
