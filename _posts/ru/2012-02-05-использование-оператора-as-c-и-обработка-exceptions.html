---
layout: post
title: "Использование оператора as (C#) и обработка Exceptions"
date: 2012-02-05 21:47:00
categories: ru
tags: [C#, Exception, MSDN]
alias: ru/blog/show/310
---
<p>Вчера первый раз в руках держал свою собственную копию бумажного варианта MSDN журнала. Новость, понятное дело, не эпическая, но хочу сказать, что именно бумажная копия журнала мотивирует на чтение MSDN статей, до этого ни разу я не читал столько статей из одного выпуска. В общем, на одной из первых страниц, в статье <a href="http://msdn.microsoft.com/en-us/magazine/hh781018.aspx">A Few of My Favorite Things... in the Entity Framework 4.2 DbContext</a> я увидел следующий код:  <div class="codeSnippetWrapper"> <div class="codeSnippet"><pre class="alt"><span class="kwrd">var</span> objectContext = (myDbContextInstance <span class="kwrd">as</span> IObjectContextAdapter).ObjectContext</pre><!--CRLF--></div></div>
<p>Что плохого в этом коде? Я просто не понимаю смысла использования оператора as в этой строке. Почему бы просто не использовать обычное приведение типов: 
<div class="codeSnippetWrapper">
<div class="codeSnippet"><pre class="alt"><span class="kwrd">var</span> objectContext = ((IObjectContextAdapter)myDbContextInstance).ObjectContext</pre><!--CRLF--></div></div>
<p>Чем этот вариант лучше предыдущего? А что если myDbContextInstance все-таки каким-то образом нельзя будет привести к типу интерфейса IObjectContextAdapter? Что будет в этом случае? В первом вариант мы получим всеми нами любимый NullReferenceException, так как оператор as вернет null в случае, если у него не удастся это приведение из типа DbContext в IObjectContextAdapter. Во втором случае мы честно получим тот самый InvalidCastException, который сразу же может дать нам понять, где именно, и в чем ошибка. 
<p>Вообще, после того, как я перешел из написания Enterprise приложений в написание Tools, я достаточно сильно пересмотрел то, как нужно обращаться к исключениям. В случае, если вы пишите Web морду, и приложение в какой-то момент не будет иметь доступа к файлу, то, скорее всего, вам бы хотелось, чтобы веб морда просто свалилась, клиент вам об этом сказал, и вы начали уже разбираться каким это образом так получилось, что у приложения появились какие-то проблемы с доступом (пример дурацкий до невозможности, но, надеюсь, вы ловите мою мысль). В случае тулзов – у вас есть куча клиентов, которые ставят свои приложения на всякие ожидаемые и неожидаемые окружения, вы понятия не имеете, что там пользователь будет делать, пока ваше приложение работает. Ожидать нужно всякое, и что пользователь захочет удалить файлы, которые открыты программой, и то, что этот файл он может заменить, и то, что он может изменить окружение в любой момент самыми различными действиями. В общем, в любой строке кода нужно понимать, что если этот код каким-то невероятным образом может вызвать исключение – его лучше поймать и обработать. </p>
