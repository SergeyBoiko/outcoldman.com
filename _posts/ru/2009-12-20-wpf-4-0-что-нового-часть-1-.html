---
layout: post
title: "WPF 4.0. Что нового? Часть 1."
date: 2009-12-20 12:03:00
categories: ru
tags: [.NET, .NET 4.0, WPF, WPF 4, Visual Studio 2010]
alias: ru/blog/show/168
---
<p>Приходит время знакомиться с новым, приближающимся WPF 4.0. Интересно посмотреть, что нам нужно сделать, чтобы перестроить текущие приложения под WPF 4.0, и какие новые функции можно пристроить к нашим WPF 3.5 программам. Вот и я решил пробежаться по всем новым функциям, чтобы быть в курсе. По мере знакомства с WPF 4.0 я понял, что в реальности ничего сверхсложного и не появилось, все какие-то доработки и доделки, в разном роде имеющие разные значимости в наших приложениях.</p>   <h2>WPF Toolkit теперь в .NET Framework 4.0</h2>  <p>В статье <a href="http://msdn.microsoft.com/en-us/library/bb613588(VS.100).aspx" target="_blank">What's New in WPF Version 4 (MSDN)</a> на MSDN приводится выражение new controls, но мы-то с вами знаем, что никакие они не новые, а это те контролы, которые раньше были в составе <a href="http://wpf.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=29117" target="_blank">WPF Toolkit</a>: <a href="http://msdn.microsoft.com/en-us/library/system.windows.controls.datagrid(VS.100).aspx" target="_blank">DataGrid</a>, <a href="http://msdn.microsoft.com/en-us/library/system.windows.controls.calendar(VS.100).aspx" target="_blank">Calendar</a> и <a href="http://msdn.microsoft.com/en-us/library/system.windows.controls.datepicker(VS.100).aspx" target="_blank">DatePicker</a>, а так же полезный класс <a href="http://msdn.microsoft.com/en-us/library/system.windows.visualstatemanager(VS.100).aspx" target="_blank">VisualStateManager</a>. При переходе с проекта на .NET 3.5 на .NET 4.0, если использовали контролы из WPFToolkit, то единственное, что нужно – это убрать зависимости на старые библиотеки Toolkit, и убрать объявления namespace’ов контролов из tookit’a. Когда эти контролы были в составе WPFToolkit’a – у них была значительная проблема: не было хорошей и достаточной справки, теперь же все будет и уже есть на MSDN. Кроме того, ScottGu обещает в серии своих статьей (<a href="http://weblogs.asp.net/scottgu/archive/2009/10/26/wpf-4-vs-2010-and-net-4-0-series.aspx" target="_blank">ScottGu - WPF 4 (VS 2010 and .NET 4.0 Series)</a>)&#160; выпуск Office Ribbon Control сразу после выпуска WPF 4, как понимаю, включат его опять в состав WPFToolkit.</p>  <p>Удивительно, что на MSDN не приводится информация о том, что DataVisualization для WPF перенесут так же в .NET Framework 4.0, неужели еще не заслужил и останется пока в рамках WPFToolkit? Странно, раз уж переносите контролы, то стоит, наверное, переносить все.</p>  <h2>Поддержка Multitouch </h2>  <p>По-моему, это просто бесспорно круто. Осталось только подождать пару лет, когда хорошие и дешевые ноутбуки с поддержкой multitouch дотянутся до нашего государства не только для любителей, но и в организации, чтобы действительно можно было начать разрабатывать приложения для них. Если пройтись по некоторым зарубежным фирмам (в основе конечно США), то можно найти уже разработанные решения для ноутбуков с поддержкой Multitouch. Печально еще (смотрел на сайте <a href="http://Lenovo.com" target="_blank">Lenovo.com</a>), что ноутбуки с Multitouch присутствуют только в комплектации с максимум 14.1 размером монитора. В принципе, для работы понятно, что может больше и не нужно - для производственной: вроде просмотр схем, инженерных чертежей, etc. А вот для программиста, теперь мне кажется, 14 дюймов мало для разработки. С другой стороны Multitouch программисту нужен, наверное, только для того, чтобы разрабатывать для Multitouch, хотя пока не попробуешь – не скажешь точно. Подождем.</p>  <p>Чтобы начать работать с Multitouch нужно ознакомиться с новыми событиями, которые добавили в классы <a href="http://msdn.microsoft.com/en-us/library/system.windows.uielement(VS.100).aspx" target="_blank">UIElement</a>, <a href="http://msdn.microsoft.com/en-us/library/system.windows.uielement3d(VS.100).aspx" target="_blank">UIElement3D</a> и <a href="http://msdn.microsoft.com/en-us/library/system.windows.contentelement(VS.100).aspx" target="_blank">ContentElement</a>, так же следует, наверное, прочитать некоторую литературу, как создавать приложения с поддержкой Multitouch действительно удобными и функциональными, ну и познакомиться с <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=3db8987b-47c8-46ca-aafb-9c3b36f43bcc&amp;displaylang=en" target="_blank">Microsoft Surface SDK</a>.</p>  <h2>Windows 7 Shell Intergration</h2>  <p>Теперь запросто можно добавлять поддержку всех красивостей и удобностей от Windows 7 в приложение. Для этого нам нужно обратиться к пространству имен <a href="http://msdn.microsoft.com/en-us/library/system.windows.shell(VS.100).aspx" target="_blank">System.Windows.Shell</a> и посмотреть, что же он нам предлагает. </p>  <p>Во-первых – это <a href="http://msdn.microsoft.com/en-us/library/system.windows.shell.taskbariteminfo(VS.100).aspx" target="_blank">TaskbarItemInfo</a>. Он предлагает управляемую обертку для Taskbar в среде Windows 7. У класса <a href="http://msdn.microsoft.com/en-us/library/system.windows.window(VS.100).aspx" target="_blank">Window</a> появилось свойство (dependency) <a href="http://msdn.microsoft.com/en-us/library/system.windows.window.taskbariteminfo(VS.100).aspx" target="_blank">TaskbarItemInfo</a>, которому и необходимо установить объект типа TaskbarItemInfo (можно как в XAML - декларативно, так и программно). При помощи свойства <a href="http://msdn.microsoft.com/en-us/library/system.windows.shell.taskbariteminfo.thumbnailclipmarginproperty(VS.100).aspx" target="_blank">ThumbnailClipMargin</a> можно установить, какая часть окна будет отображена в Preview окна на taskbar (показывается при наведении, если включено Aero), то есть можно отображать не все окно, а, например, только значимую необходимую часть. Правда не понял, возможно ли вообще отображать какой-то свой шаблон в Preview, который не отображается в окне, такого свойства я не обнаружил, подозреваю, что нужно как-то отображать через спрятанные области. Не удивляйтесь, что когда попробуете использовать TaskbarItemInfo – изменений не увидите на панели Taskbar после запуска под debug из студии, не понял, с чем это связано (скорее всего, с хостящимся процессом от VS для процесса debug), в общем нужно отдельно запускать exe, и тогда все будет работать (может, проблема проявляется только у меня, что-нибудь с Win7 x64 – не знаю, вы, может, скажете?). Более того <a href="http://msdn.microsoft.com/en-us/library/system.windows.shell.taskbariteminfo(VS.100).aspx" target="_blank">TaskbarItemInfo</a> позволяет отобразить функциональные клавиши в том же Preview (<a href="http://msdn.microsoft.com/en-us/library/system.windows.shell.taskbariteminfo.thumbbuttoninfos(VS.100).aspx" target="_blank">ThumbButtonInfos</a>), а так же отобразить какой-нибудь свой элемент над иконкой на Taskbar (<a href="http://msdn.microsoft.com/en-us/library/system.windows.shell.taskbariteminfo.overlay(VS.100).aspx" target="_blank">Overlay</a>), и состояние длительного процесса (<a href="http://msdn.microsoft.com/en-us/library/system.windows.shell.taskbariteminfo.progressvalue(VS.100).aspx" target="_blank">ProgressValue</a> и <a href="http://msdn.microsoft.com/en-us/library/system.windows.shell.taskbariteminfo.progressstate(VS.100).aspx" target="_blank">ProgressState</a>). Вот как будет это выглядеть (пример с <a href="http://msdn.microsoft.com/en-us/library/system.windows.shell.taskbariteminfo(VS.100).aspx" target="_blank">MSDN</a>)</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="Untitled8" border="0" alt="Untitled8" src="/library/images/01/0000066.png" width="469" height="430" /></p>  <p>Другим дополнением является <a href="http://msdn.microsoft.com/en-us/library/system.windows.shell.jumplist(VS.100).aspx" target="_blank">JumpList</a>. Тут все просто, он может в себя включать либо <a href="http://msdn.microsoft.com/en-us/library/system.windows.shell.jumptask(VS.100).aspx" target="_blank">JumpTask</a>, либо <a href="http://msdn.microsoft.com/en-us/library/system.windows.shell.jumppath(VS.100).aspx" target="_blank">JumpPath</a>, первый может задавать программу с набором аргументов, второй путь до файла. Очень удобная вещь для часто выполняемых задач, правда, пользоваться в Windows 7 Jump листами я пока не привык, да и вообще не пользуюсь, потому как нужно еще помнить, что ты открывал последним.</p>  <p>Windows 7 shell integration полезное дополнение, но так как в основном мы все программируем для корпоративных клиентов, то на него нужно смотреть как на возможность дополнения функциональности приложения, если у пользователя стоит Windows 7. Так, если мы как-то отображаем долгий процесс, то почему бы и не отобразить его при помощи <a href="http://msdn.microsoft.com/en-us/library/system.windows.shell.taskbariteminfo(VS.100).aspx" target="_blank">TaskbarItemInfo</a> в дополнение: тогда играющий в косынку менеджер всегда сможет заметить, когда программа закончила формировать отчет или выполнила какую либо задачу. Но вот вынести часто используемые файлы просто в <a href="http://msdn.microsoft.com/en-us/library/system.windows.shell.jumplist(VS.100).aspx" target="_blank">JumpList</a> не достаточно, так как мы ограничим пользователей, которые используют более ранние версии Windows, а о них тоже стоит подумать.</p> <p>  </p>
