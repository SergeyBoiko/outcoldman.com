---
layout: post
title: "Используем Deep Zoom Composer"
date: 2009-09-18 08:38:00
categories: ru
tags: [JavaScript, Deep Zoom Composer, Seadragon, Deep Zoom, Silverlight]
alias: ru/blog/show/158
---
<p>Недавно Константин Кичинский в своем блоге представил <a href="http://blogs.msdn.com/kichinsky/archive/2009/09/03/Deep-Zoom-Composer-1.0-overview.aspx">Deep Zoom Composer 1.0</a>, скачать который можно с сайта <a href="http://www.microsoft.com/downloads/details.aspx?familyid=457b17b7-52bf-4bda-87a3-fa8a4673f8bf&amp;displaylang=en">Microsoft</a>. Что это такое и как работает я предлагаю прочитать в его блоге. А сейчас я хотел бы продемонстрировать как это можно использовать.</p>   <p>Первое на что следует обратить внимание – это то, что экспорт в Deep Zoom Composer может осуществляться как в Silverlight Deep Zoom, так и в <a href="http://livelabs.com/seadragon-ajax/">Seadragon Ajax</a>. Главный вопрос при использовании Silverlight на сайте встает о процентном соотношении пользователей, у которых установлен Silverlight – он достаточно мал, в особенности в сравнении с Flash (<a title="http://www.riastats.com/" href="http://www.riastats.com/">http://www.riastats.com/</a>):</p>  <p><a href="http://www.riastats.com/"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="http://www.riastats.com/" border="0" alt="http://www.riastats.com/" src="/library/images/01/0000003.png" width="644" height="299" /></a> </p>  <p>Следовательно, лучший вариант – это использовать Silverlight когда это возможно, а когда нет – не мучать пользователя просьбой установки, а показать тот же функционал на JavaScript + Ajax. Дальше должен следовать вопрос, а почему бы сразу не сделать все на JavaScript – ответ прост, картинки выглядят не очень хорошо при использовании JavaScript, а так же Flash в сравнении в том, как их отображает Silverlight (можете попробовать сделать экспорт из Deep Zoom Composer в Seadragon Ajax и Silverlight и сравнить. Притом Deep Zoom Composer позволяет делать это достаточно просто.</p>  <p>Итак, давайте посмотрим, как это можно сделать. После того как вы создадите проект в Deep Zoom Composer и подготовите его перед вами встанет третья вкладка – Export, сделаем экспорт сначала с типом Silverlight, а затем с типом Seadragon Ajax.</p>  <p>После того, как эспорт завершится вы должны увидеть в той папке, куда вы экспортировали несколько файлов и папок. Обратить стоит внимание на файл GeneratedImages/scene.xml, который содержит основные стили Silverlight приложения, там вы можете поправить как будут выглядеть tooltip’ы или toolbar вашего приложения. </p>  <p>Для того, чтобы показать как на странице при неустановленном Silverlight отобразить Seadragon Ajax откроем файл Test.html, там есть описание нашего Silverlight объекта - object внутри которого прописаны параметры самого объекта, а так же то, как будет выглядеть данная область, если Silverlight не установлен (по умолчанию картинка с информацией о том, что нужно скачать его). Вместо ссылки кладем туда контейнер div из сгенерированного файла seadragonajax.html &lt;div id=&quot;container&quot;&gt;&lt;/div&gt;, чтобы получилось так:</p> 

<div id="codeSnippetWrapper" style="background-color: #f4f4f4;color: black;font-family: 'Courier New', Courier, Monospace;	font-size: 9pt; line-height: 12pt; border: solid 1px silver; cursor: text; margin: 20px 0px 10px 0px; overflow: auto; padding: 4px; width: 97.5%; direction: ltr; text-align: left;"><div id="codeSnippet" >
<pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">object</span> <span style="color: #ff0000;">data</span><span style="color: #0000ff;">="data:application/x-silverlight-2,"</span> <span style="color: #ff0000;">type</span><span style="color: #0000ff;">="application/x-silverlight-2"</span>  </pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">            <span style="color: #ff0000;">width</span><span style="color: #0000ff;">="800"</span> <span style="color: #ff0000;">height</span><span style="color: #0000ff;">="500"</span><span style="color: #0000ff;">&gt;</span> </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">&nbsp;</pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param</span> <span style="color: #ff0000;">name</span><span style="color: #0000ff;">="minRuntimeVersion"</span> <span style="color: #ff0000;">value</span><span style="color: #0000ff;">="3.0.40307.0"</span> <span style="color: #0000ff;">/&gt;</span> </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param</span> <span style="color: #ff0000;">name</span><span style="color: #0000ff;">="autoUpgrade"</span> <span style="color: #ff0000;">value</span><span style="color: #0000ff;">="false"</span> <span style="color: #0000ff;">/&gt;</span> </pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param</span> <span style="color: #ff0000;">name</span><span style="color: #0000ff;">="source"</span> <span style="color: #ff0000;">value</span><span style="color: #0000ff;">="Default.xap"</span><span style="color: #0000ff;">/&gt;</span> </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param</span> <span style="color: #ff0000;">name</span><span style="color: #0000ff;">="onerror"</span> <span style="color: #ff0000;">value</span><span style="color: #0000ff;">="onSilverlightError"</span> <span style="color: #0000ff;">/&gt;</span> </pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param</span> <span style="color: #ff0000;">name</span><span style="color: #0000ff;">="background"</span> <span style="color: #ff0000;">value</span><span style="color: #0000ff;">="white"</span> <span style="color: #0000ff;">/&gt;</span> </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">param</span> <span style="color: #ff0000;">name</span><span style="color: #0000ff;">="initParams"</span> <span style="color: #ff0000;">value</span><span style="color: #0000ff;">="adFile=GeneratedImages"</span> <span style="color: #0000ff;">/&gt;</span> </pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div</span> <span style="color: #ff0000;">id</span><span style="color: #0000ff;">="container"</span><span style="color: #0000ff;">&gt;</span> </pre><!--CRLF--><pre style="border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;">    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> </pre><!--CRLF--><pre style="background-color: white;border-style: none; overflow: visible; padding: 0px; width: 100%; margin: 0em;"><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">object</span><span style="color: #0000ff;">&gt;</span></pre><!--CRLF--></div></div>


<p>Из файла seadragonajax.html нам так же потребуется забрать скрипт, который инициализирует Seadragon Ajax, немного поправив, добавив проверку, что элемент container присутствует на странице:</p>  

<div id="codeSnippetWrapper" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; width: 97.5%; font-family: 'Courier New', courier, monospace; direction: ltr; font-size: normal; overflow: auto; cursor: text; border: silver 1px solid; padding: 4px;">
<div id="codeSnippet" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: normal; overflow: visible; border-style: none; padding: 0px;">
<pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: normal; overflow: visible; border-style: none; padding: 0px;"><span style="color: #0000ff">function</span> start() {</pre>
<!--CRLF-->
<pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: normal; overflow: visible; border-style: none; padding: 0px;">    <span style="color: #0000ff">var</span> container = document.getElementById(<span style="color: #006080">"container"</span>);</pre>
<!--CRLF-->
<pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: normal; overflow: visible; border-style: none; padding: 0px;">    <span style="color: #0000ff">if</span> (container != <span style="color: #0000ff">null</span>) {</pre>
<!--CRLF-->
<pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: normal; overflow: visible; border-style: none; padding: 0px;">        <span style="color: #0000ff">var</span> script = document.getElementById(<span style="color: #006080">'seadragon_javascript'</span>);</pre>
<!--CRLF-->
<pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: normal; overflow: visible; border-style: none; padding: 0px;">        script.src = <span style="color: #006080">'http://seadragon.com/ajax/0.8/seadragon-min.js'</span>;</pre>
<!--CRLF-->
<pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: normal; overflow: visible; border-style: none; padding: 0px;">        script.onreadystatechange = <span style="color: #0000ff">function</span>() {</pre>
<!--CRLF-->
<pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: normal; overflow: visible; border-style: none; padding: 0px;">            Seadragon.Config.imagePath = <span style="color: #006080">"img/"</span>;</pre>
<!--CRLF-->
<pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: normal; overflow: visible; border-style: none; padding: 0px;">            <span style="color: #0000ff">var</span> viewer = <span style="color: #0000ff">new</span> Seadragon.Viewer(<span style="color: #006080">"container"</span>);</pre>
<!--CRLF-->
<pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: normal; overflow: visible; border-style: none; padding: 0px;">            viewer.openDzi(<span style="color: #006080">"GeneratedImages/dzc_output.xml"</span>);</pre>
<!--CRLF-->
<pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: normal; overflow: visible; border-style: none; padding: 0px;">        }</pre>
<!--CRLF-->
<pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: normal; overflow: visible; border-style: none; padding: 0px;">    }</pre>
<!--CRLF-->
<pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: normal; overflow: visible; border-style: none; padding: 0px;">}</pre>
<!--CRLF--></div>
</div>

<p>Конечно же хорошо будет, если в случае Javascript вы напишите “You may install Silverlight to see more interactive gallery.” со ссылкой на инсталлер Silverlight.</p> 

 <p>Ну и в конце вы можете получить, например, такой результат - <a href="/library/content/01/dzcsample/test.html">http://outcoldman.com/library/content/01/dzcsample/test.html</a></p>  <p></p> </object>  <p></p>  <h4>Скачать пример: <a href="/library/content/01/DZCSample.zip">DZCSample.zip</a>
</h4>
<p>
<a rev="vote-for" href="http://progg.ru/outcoldman-%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D1%83%D0%B5%D0%BC-Deep-Zoom-Composer"><img alt="Progg it" src="http://progg.ru/image.axd?url=http%3A%2F%2Foutcoldman.livejournal.com%2F39232.html" style="border:0px" /></a>
 </p>
