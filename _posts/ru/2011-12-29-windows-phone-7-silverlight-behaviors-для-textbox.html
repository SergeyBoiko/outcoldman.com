---
layout: post
title: "Windows Phone 7 Silverlight: Behaviors для TextBox"
date: 2011-12-29 21:16:00
categories: ru
tags: [Silverlight, XAML, Expression Blend, Binding, Windows Phone 7, Behavior, Blend, Interactivity]
alias: ru/blog/show/307
---
<p>Термины Behaviors и Interactions ввели две библиотеки, поставляемые вместе с продуктом Expression Blend. Эти библиотеки еще известны со времен Silverlight и WPF, и предполагаю, что большинство разработчиков про них знает. Найти эти библиотеки можно в директории “c:\Program Files (x86)\Microsoft SDKs\Expression\Blend\” (если Windows 32 битный, то без (x86)), если Expression Blend был установлен. В этой папке вы сможете найти&#160; библиотеки для WPF/Silverlight/WindowsPhone. Зачем они нужны и как их правильно использовать вы можете узнать, пройдя по ссылки на MSDN <a href="http://msdn.microsoft.com/en-us/library/dd440765.aspx">Expression Blend SDK for Windows Phone</a>. Если кратко: это способ расширят функциональность контролов, да еще и так, чтобы поддерживался паттерн MVVM (байндинги и т.п.).&#160; </p>  <p>При разработке своего первого приложения мне потребовалось несколько Behaviors для TextBox, которыми я и хочу с вами поделиться.</p>    <h2>FocusOnLoadedBehavior</h2>  <p>Если вы откроете редактирование контакта, а далее одного из пунктов контакта, на Windows Phone телефоне, то приложение установит сразу же фокус на первый TextBox. Достаточно удобно, так как, скорее всего, это то, что вам действительно нужно: вы открыли редактирование контакта, и, скорее всего, вы сразу же захотите поменять что-то. Спорный немного вопрос нужно ли устанавливать фокус, если у вас более одного TextBox на этой странице, в случае редактирования имени контакта он устанавливается, но все же, может быть, я собираюсь редактировать информацию только в третьем TextBox. Но в целом идея понятная. Я написал следующий Behavior:</p>  <div class="codeSnippetWrapper" style="cursor: text; font-size: 9pt; border-top: silver 1px solid; font-family: tahoma, verdana, courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; color: black; overflow: auto; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 10pt; padding-right: 4px; background-color: #f4f4f4">   <div class="codeSnippet" style="padding-bottom: 0px; padding-top: 0px; padding-left: 0px; padding-right: 0px">     <pre style="margin: 0em; background-color: white"><span style="color: #008000">/// &lt;summary&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em"><span style="color: #008000">/// UI Behavior to set focus to &lt;see cref=&quot;AssociatedObject&quot;/&gt; on loaded event.</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white"><span style="color: #008000">/// &lt;/summary&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em"><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> FocusOnLoadedBehavior : Behavior&lt;Control&gt;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">{</pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">readonly</span> DependencyProperty SetFocusOnLoadedProperty =</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        DependencyProperty.Register(<span style="color: #006080">&quot;SetFocusOnLoaded&quot;</span>, <span style="color: #0000ff">typeof</span>(<span style="color: #0000ff">bool</span>), <span style="color: #0000ff">typeof</span>(FocusOnLoadedBehavior), <span style="color: #0000ff">new</span> PropertyMetadata(<span style="color: #0000ff">true</span>));</pre>
<!--CRLF-->

    <pre style="margin: 0em">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    <span style="color: #008000">/// &lt;summary&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #008000">/// Set focus to &lt;see cref=&quot;AssociatedObject&quot;/&gt; on loaded event. By default &lt;value&gt;true&lt;/value&gt;.</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    <span style="color: #008000">/// &lt;/summary&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">bool</span> SetFocusOnLoaded</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em">        get { <span style="color: #0000ff">return</span> (<span style="color: #0000ff">bool</span>)GetValue(SetFocusOnLoadedProperty); }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        set { SetValue(SetFocusOnLoadedProperty, <span style="color: #0000ff">value</span>); }</pre>
<!--CRLF-->

    <pre style="margin: 0em">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> OnAttached()</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em">        <span style="color: #0000ff">base</span>.OnAttached();</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">        AssociatedObject.Loaded += AssociatedObject_Loaded;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    <span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> OnDetaching()</pre>
<!--CRLF-->

    <pre style="margin: 0em">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        <span style="color: #0000ff">base</span>.OnDetaching();</pre>
<!--CRLF-->

    <pre style="margin: 0em">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        AssociatedObject.Loaded -= AssociatedObject_Loaded;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">void</span> AssociatedObject_Loaded(<span style="color: #0000ff">object</span> sender, RoutedEventArgs e)</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em">        AssociatedObject.Loaded -= AssociatedObject_Loaded;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">        <span style="color: #0000ff">if</span> (SetFocusOnLoaded)</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        {</pre>
<!--CRLF-->

    <pre style="margin: 0em">            AssociatedObject.Focus();</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        }</pre>
<!--CRLF-->

    <pre style="margin: 0em">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">}</pre>
<!--CRLF--></div>
</div>

<p>Все очень просто, добавляем этот Behavior для определенного TextBox на странице, и туда установится фокус при открытии страницы (на самом деле фокус устанавливается на Loaded событие контрола, а в случае добавления контролов в runtime – это будет именно Loaded контрола, а не страницы):</p>

<div class="codeSnippetWrapper" style="cursor: text; font-size: 9pt; border-top: silver 1px solid; font-family: tahoma, verdana, courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; color: black; overflow: auto; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 10pt; padding-right: 4px; background-color: #f4f4f4">
  <div class="codeSnippet" style="padding-bottom: 0px; padding-top: 0px; padding-left: 0px; padding-right: 0px">
    <pre style="margin: 0em; background-color: white"><span style="color: #0000ff">&lt;</span><span style="color: #800000">TextBox</span> <span style="color: #ff0000">MaxLength</span><span style="color: #0000ff">=&quot;255&quot;</span> <span style="color: #ff0000">Text</span><span style="color: #0000ff">=&quot;{Binding Path=DisplayName, Mode=TwoWay}&quot;</span> </pre>
<!--CRLF-->

    <pre style="margin: 0em">     <span style="color: #ff0000">xmlns:interactivity</span><span style="color: #0000ff">=&quot;clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity&quot;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">     <span style="color: #ff0000">xmlns:oBehaviors</span><span style="color: #0000ff">=&quot;clr-namespace:outcold.Phone.Behaviors;assembly=outcold.Phone&quot;</span><span style="color: #0000ff">&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">&lt;</span><span style="color: #800000">interactivity:Interaction.Behaviors</span><span style="color: #0000ff">&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        <span style="color: #0000ff">&lt;</span><span style="color: #800000">oBehaviors:FocusOnLoadedBehavior</span> <span style="color: #0000ff">/&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">interactivity:Interaction.Behaviors</span><span style="color: #0000ff">&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white"><span style="color: #0000ff">&lt;/</span><span style="color: #800000">TextBox</span><span style="color: #0000ff">&gt;</span></pre>
<!--CRLF--></div>
</div>

<p>Само собой, пространства имен interactivity и oBehaviors вы можете вынести на более верхний элемент (на страницу, например). </p>

<p>У этого Behavior так же есть свойство SetFocusOnLoad, оно там для того, чтобы была возможность отключить установку фокуса на Load этого контрола. Сделано это для того, например, когда вам нужно в зависимости от ситуации поставить фокус в один из двух TextBox контролов.</p>

<h2>TextBoxSelectOnFocusBehavior</h2>

<p>В добавление к FocusOnLoadedBehavior часто нужно использовать и этот behavior. Он устанавливает курсор на заданную позицию. Давайте я сначала приведу его код:</p>

<div class="codeSnippetWrapper" style="cursor: text; font-size: 9pt; border-top: silver 1px solid; font-family: tahoma, verdana, courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; color: black; overflow: auto; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 10pt; padding-right: 4px; background-color: #f4f4f4">
  <div class="codeSnippet" style="padding-bottom: 0px; padding-top: 0px; padding-left: 0px; padding-right: 0px">
    <pre style="margin: 0em; background-color: white"><span style="color: #0000ff">public</span> <span style="color: #0000ff">enum</span> TextBoxFocusSelectType</pre>
<!--CRLF-->

    <pre style="margin: 0em">{</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    None = 0, </pre>
<!--CRLF-->

    <pre style="margin: 0em">    SelectAll = 1,</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    SetCursorToTheEnd = 2</pre>
<!--CRLF-->

    <pre style="margin: 0em">}</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em"><span style="color: #008000">/// &lt;summary&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white"><span style="color: #008000">/// UI Behavior to set how to select text in TextBox on Focused.</span></pre>
<!--CRLF-->

    <pre style="margin: 0em"><span style="color: #008000">/// &lt;/summary&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white"><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> TextBoxSelectOnFocusBehavior : Behavior&lt;TextBox&gt;</pre>
<!--CRLF-->

    <pre style="margin: 0em">{</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    <span style="color: #0000ff">public</span> TextBoxSelectOnFocusBehavior()</pre>
<!--CRLF-->

    <pre style="margin: 0em">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        Type = TextBoxFocusSelectType.None;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #008000">/// &lt;summary&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    <span style="color: #008000">/// Set behavior of how to select text in &lt;see cref=&quot;AssociatedObject&quot;/&gt;.</span></pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #008000">/// By default &lt;value&gt;TextBoxFocusSelectType.None&lt;/value&gt;.</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    <span style="color: #008000">/// &lt;/summary&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">public</span> TextBoxFocusSelectType Type</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em">        get;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        set;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> OnAttached()</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em">        <span style="color: #0000ff">base</span>.OnAttached();</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">        AssociatedObject.GotFocus += AssociatedObject_GotFocus;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    <span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> OnDetaching()</pre>
<!--CRLF-->

    <pre style="margin: 0em">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        <span style="color: #0000ff">base</span>.OnDetaching();</pre>
<!--CRLF-->

    <pre style="margin: 0em">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        AssociatedObject.GotFocus -= AssociatedObject_GotFocus;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">void</span> AssociatedObject_GotFocus(<span style="color: #0000ff">object</span> sender, RoutedEventArgs e)</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em">        <span style="color: #0000ff">if</span> (Type == TextBoxFocusSelectType.SelectAll)</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        {</pre>
<!--CRLF-->

    <pre style="margin: 0em">            AssociatedObject.SelectAll();</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        }</pre>
<!--CRLF-->

    <pre style="margin: 0em">        <span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (Type == TextBoxFocusSelectType.SetCursorToTheEnd)</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        {</pre>
<!--CRLF-->

    <pre style="margin: 0em">            AssociatedObject.Select(AssociatedObject.Text.Length, 0);</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        }</pre>
<!--CRLF-->

    <pre style="margin: 0em">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">}</pre>
<!--CRLF--></div>
</div>

<p>Когда пользователь фокусируется на определенном TextBox, у него бывают разные потребности по изменению текста. Первая потребность – это полностью заменить текст, часто – при редактировании небольших цифр, дат. В этом случае нам нужно выделить весь текст в TextBox, чтобы при наборе цифр пользователь набрал все быстро с самого начала. Вторая потребность – это просто подредактировать текст, в случае Windows Phone, когда у нас нет кнопки Delete (предполагаю, что такая функция есть, но я ее не знаю), а только Backspace, то мы просто обязаны постоянно устанавливать курсор именно в конец текста. </p>

<p>Свойство Type я сделал без поддержки байндинга, у меня не было необходимости. Итого, пример может выглядеть так:</p>

<div class="codeSnippetWrapper" style="cursor: text; font-size: 9pt; border-top: silver 1px solid; font-family: tahoma, verdana, courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; color: black; overflow: auto; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 10pt; padding-right: 4px; background-color: #f4f4f4">
  <div class="codeSnippet" style="padding-bottom: 0px; padding-top: 0px; padding-left: 0px; padding-right: 0px">
    <pre style="margin: 0em; background-color: white"><span style="color: #0000ff">&lt;</span><span style="color: #800000">TextBox</span> <span style="color: #ff0000">MaxLength</span><span style="color: #0000ff">=&quot;255&quot;</span> <span style="color: #ff0000">Text</span><span style="color: #0000ff">=&quot;{Binding Path=DisplayName, Mode=TwoWay}&quot;</span> </pre>
<!--CRLF-->

    <pre style="margin: 0em">     <span style="color: #ff0000">xmlns:interactivity</span><span style="color: #0000ff">=&quot;clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity&quot;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">     <span style="color: #ff0000">xmlns:oBehaviors</span><span style="color: #0000ff">=&quot;clr-namespace:outcold.Phone.Behaviors;assembly=outcold.Phone&quot;</span><span style="color: #0000ff">&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">&lt;</span><span style="color: #800000">interactivity:Interaction.Behaviors</span><span style="color: #0000ff">&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        <span style="color: #0000ff">&lt;</span><span style="color: #800000">oBehaviors:FocusOnLoadedBehavior</span> <span style="color: #0000ff">/&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em">        <span style="color: #0000ff">&lt;</span><span style="color: #800000">oBehaviors:TextBoxSelectOnFocusBehavior</span> <span style="color: #ff0000">Type</span><span style="color: #0000ff">=&quot;SetCursorToTheEnd&quot;</span> <span style="color: #0000ff">/&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">interactivity:Interaction.Behaviors</span><span style="color: #0000ff">&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em"><span style="color: #0000ff">&lt;/</span><span style="color: #800000">TextBox</span><span style="color: #0000ff">&gt;</span></pre>
<!--CRLF--></div>
</div>

<h2>TextBoxInputRegexFilterBehavior</h2>

<p>И последний на сегодня Behavior – это TextBoxInputRegexFilterBehavior, который помогает фильтровать текст, который пользователь хочет ввести. На самом деле, этот Behavior достаточно спорный, так как чрезмерное его употребление может смутить пользователя, и нужно его использовать только в очевидных местах. Один из таких моментов был у меня, когда мне было необходимо получить от пользователя целое число, а клавиатура с InputScope=”Number” содержит помимо цифр еще и точку. В одном из приложений в marketplace я видел, как какой-то разработчик написал собственную клавиатуру, чтобы решить эту проблему. Мне это решение совсем не понравилось, а так же я совсем не хочу использовать какие либо валидаторы в Windows Phone приложениях, экран слишком маленький для валидаторов. Поэтому я написал TextBoxInputRegexFilterBehavior:</p>

<div class="codeSnippetWrapper" style="cursor: text; font-size: 9pt; border-top: silver 1px solid; font-family: tahoma, verdana, courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; color: black; overflow: auto; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 10pt; padding-right: 4px; background-color: #f4f4f4">
  <div class="codeSnippet" style="padding-bottom: 0px; padding-top: 0px; padding-left: 0px; padding-right: 0px">
    <pre style="margin: 0em; background-color: white"><span style="color: #008000">/// &lt;summary&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em"><span style="color: #008000">/// UI behavior for &lt;see cref=&quot;TextBox&quot;/&gt; to filter input text with special RegularExpression</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white"><span style="color: #008000">/// &lt;/summary&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em"><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> TextBoxInputRegexFilterBehavior : Behavior&lt;TextBox&gt;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">{</pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">private</span> Regex _regex;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">private</span> <span style="color: #0000ff">string</span> _originalText;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    <span style="color: #0000ff">private</span> <span style="color: #0000ff">int</span> _originalSelectionStart;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">private</span> <span style="color: #0000ff">int</span> _originalSelectionLength;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">string</span> RegularExpression </pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em">        get { <span style="color: #0000ff">return</span> _regex.ToString(); } </pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        set </pre>
<!--CRLF-->

    <pre style="margin: 0em">        {</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">            <span style="color: #0000ff">if</span> (<span style="color: #0000ff">string</span>.IsNullOrEmpty(<span style="color: #0000ff">value</span>))</pre>
<!--CRLF-->

    <pre style="margin: 0em">            {</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">                _regex = <span style="color: #0000ff">null</span>;</pre>
<!--CRLF-->

    <pre style="margin: 0em">            }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">            <span style="color: #0000ff">else</span></pre>
<!--CRLF-->

    <pre style="margin: 0em">            {</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">                _regex = <span style="color: #0000ff">new</span> Regex(<span style="color: #0000ff">value</span>);</pre>
<!--CRLF-->

    <pre style="margin: 0em">            }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        } </pre>
<!--CRLF-->

    <pre style="margin: 0em">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> OnAttached()</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em">        <span style="color: #0000ff">base</span>.OnAttached();</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">        AssociatedObject.TextInputStart += AssociatedObject_TextInputStart;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        AssociatedObject.TextChanged += AssociatedObject_TextChanged;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> OnDetaching()</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em">        <span style="color: #0000ff">base</span>.OnDetaching();</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">        AssociatedObject.TextInputStart -= AssociatedObject_TextInputStart;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        AssociatedObject.TextChanged -= AssociatedObject_TextChanged;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">void</span> AssociatedObject_TextInputStart(<span style="color: #0000ff">object</span> sender, TextCompositionEventArgs e)</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em">        <span style="color: #0000ff">if</span> (_regex != <span style="color: #0000ff">null</span> &amp;&amp; e.Text != <span style="color: #0000ff">null</span> &amp;&amp; !(e.Text.Length == 1 &amp;&amp; Char.IsControl(e.Text[0])))</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        {</pre>
<!--CRLF-->

    <pre style="margin: 0em">            <span style="color: #0000ff">if</span> (!_regex.IsMatch(e.Text))</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">            {</pre>
<!--CRLF-->

    <pre style="margin: 0em">                _originalText = AssociatedObject.Text;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">                _originalSelectionStart = AssociatedObject.SelectionStart;</pre>
<!--CRLF-->

    <pre style="margin: 0em">                _originalSelectionLength = AssociatedObject.SelectionLength;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">            }</pre>
<!--CRLF-->

    <pre style="margin: 0em">        }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em">&#160;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> AssociatedObject_TextChanged(<span style="color: #0000ff">object</span> sender, TextChangedEventArgs e)</pre>
<!--CRLF-->

    <pre style="margin: 0em">    {</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        <span style="color: #0000ff">if</span> (_originalText != <span style="color: #0000ff">null</span>)</pre>
<!--CRLF-->

    <pre style="margin: 0em">        {</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">            <span style="color: #0000ff">string</span> text = _originalText;</pre>
<!--CRLF-->

    <pre style="margin: 0em">            _originalText = <span style="color: #0000ff">null</span>;</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">            AssociatedObject.Text = text;</pre>
<!--CRLF-->

    <pre style="margin: 0em">            AssociatedObject.Select(_originalSelectionStart, _originalSelectionLength);</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        }</pre>
<!--CRLF-->

    <pre style="margin: 0em">    }</pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">}</pre>
<!--CRLF--></div>
</div>

<p>Использовать его можно, например, так:</p>

<div class="codeSnippetWrapper" style="cursor: text; font-size: 9pt; border-top: silver 1px solid; font-family: tahoma, verdana, courier, monospace; border-right: silver 1px solid; width: 97.5%; border-bottom: silver 1px solid; color: black; overflow: auto; padding-bottom: 4px; direction: ltr; text-align: left; padding-top: 4px; padding-left: 4px; margin: 20px 0px 10px; border-left: silver 1px solid; line-height: 10pt; padding-right: 4px; background-color: #f4f4f4">
  <div class="codeSnippet" style="padding-bottom: 0px; padding-top: 0px; padding-left: 0px; padding-right: 0px">
    <pre style="margin: 0em; background-color: white"><span style="color: #0000ff">&lt;</span><span style="color: #800000">TextBox</span> <span style="color: #ff0000">Text</span><span style="color: #0000ff">=&quot;{Binding Path=Value, Mode=TwoWay}&quot;</span> <span style="color: #ff0000">MaxLength</span><span style="color: #0000ff">=&quot;3&quot;</span> <span style="color: #ff0000">Width</span><span style="color: #0000ff">=&quot;100&quot;</span> <span style="color: #ff0000">InputScope</span><span style="color: #0000ff">=&quot;Number&quot;</span> </pre>
<!--CRLF-->

    <pre style="margin: 0em">        <span style="color: #ff0000">xmlns:interactivity</span><span style="color: #0000ff">=&quot;clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity&quot;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        <span style="color: #ff0000">xmlns:oBehaviors</span><span style="color: #0000ff">=&quot;clr-namespace:outcold.Phone.Behaviors;assembly=outcold.Phone&quot;</span><span style="color: #0000ff">&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em">    <span style="color: #0000ff">&lt;</span><span style="color: #800000">interactivity:Interaction.Behaviors</span><span style="color: #0000ff">&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">        <span style="color: #0000ff">&lt;</span><span style="color: #800000">oBehaviors:TextBoxSelectOnFocusBehavior</span> <span style="color: #ff0000">Type</span><span style="color: #0000ff">=&quot;SelectAll&quot;</span> <span style="color: #0000ff">/&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em">        <span style="color: #0000ff">&lt;</span><span style="color: #800000">oBehaviors:TextBoxInputRegexFilterBehavior</span> <span style="color: #ff0000">RegularExpression</span><span style="color: #0000ff">=&quot;[0-9]+&quot;</span> <span style="color: #0000ff">/&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em; background-color: white">    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">interactivity:Interaction.Behaviors</span><span style="color: #0000ff">&gt;</span></pre>
<!--CRLF-->

    <pre style="margin: 0em"><span style="color: #0000ff">&lt;/</span><span style="color: #800000">TextBox</span><span style="color: #0000ff">&gt;</span></pre>
<!--CRLF--></div>
</div>

<p>В будущем я буду приводить и другие Behavior, которые мне помогают при разработке. Вы же обязательно ознакомьтесь с <a href="http://msdn.microsoft.com/en-us/library/dd440765.aspx">документацией на MSDN</a>, так как эти библиотеки несут в себе еще и замечательные триггеры, а так же готовые Behaviors.</p>
