---
layout: post
title: "Linq To Twitter: Считаем слова, хеш-теги и собеседников сами"
date: 2009-12-03 08:47:00
categories: ru
tags: [C#, WPF, Twitter, Linq-To-Twitter, TwitterCloud]
alias: ru/blog/show/166
---
<p>Недавно в сети начала гулять ссылка на проект <a title="http://tweetcloud.icodeforlove.com/" href="http://tweetcloud.icodeforlove.com/">http://tweetcloud.icodeforlove.com/</a>, который мог подсчитать количество используемых слов в ваших сообщениях в twitter и нарисовать некий граф. Но у данного проекта было несколько больших недостатков: русские слова не считались, после подсчета он писал в tweet – спамил про себя. Может быть и еще какие то недостатки: первых двух мне хватило, чтобы не лезть смотреть этот проект. Но, вспомним чудесный продукт <a href="http://linqtotwitter.codeplex.com/" target="_blank">LinqToTwitter</a>, о котором я уже как то <a href="http://outcoldman.livejournal.com/34574.html" target="_blank">писал</a> в своем блоге. Ну и понятно, что подсчитать количество слов не составит особого труда.</p>  <p>Потому, берем WPF + LinqToTwitter, пару вечеров и наше облако тегов готово:</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Capture" border="0" alt="Capture" src="{{ site.url }}/library/images/01/0000065.png" width="638" height="494" /> </p>  <p>Сразу скажу, что пока писал меня вроде <strong>пару раз забанили</strong> на TwitterAPI (с ним, вроде, должен работать LinqToTwitter), я добавил Thread.Sleep(200) в промежутки запросов, чтобы хоть как то разгрузить, но проблемы остались – бывают реже, но бывают, так что учтите (<strong>не увлекайтесь</strong>). После бана около суток не будут работать клиенты. У меня 800 твиттов грузятся и обрабатываются около минуты, время рассчитайте сами – сколько вам потребуется, чтобы подсчитать ваши слова.</p>  <h2>Программа</h2>  <p>Теперь пару слов о самой программе и интерфейсе. В верхний правый угол вбиваем пользователя и пароль и жмем кнопку Create Cloud, пошел progress bar, который можно в любой момент остановить кнопкой Stop (справа от него). Если нужно вынести какие то слова из статистики вписываем их через запятую или пробел в поле Parasites words. Сначала сам хотел заполнить как можно большим набором таких слов, а потом подумал, что все таки интересно сколько слов паразитов я действительно использую, так что по умолчанию осталось там мало. Статистику по словам я разбил на три группы “Слова”, “Хеш-теги”, “Пользователи”. Так же программа рядом с собой кладет лог файл, в который пишет все твитты, которые она скачала.</p>  <p>После загрузки, да и вообще в любой момент, можете нажать на логотип twitter и сохранить скриншот программы в файл *.png.</p>  <h2>Внутренности</h2>  <p>Что пришлось и что использовал внутри. Ну само собой LinqToTwitter, который пришлось пересобрать самому и выкинуть зависимости на библиотеки DotNetOpenAuth.dll и Kerr.Credentials.dll, так как с ними у меня на Any CPU сборка не работала, точнее не подгружалась библиотека Kerr.Credentials.dll при запуске (машина x64). Для визуализации использовал WPF – потому что быстро и сердито. Для того чтобы поле <a href="http://msdn.microsoft.com/en-us/library/system.windows.controls.passwordbox.aspx" target="_blank">PasswordBox</a> можно было биндить – взял решение <a href="http://blog.functionalfun.net/2008/06/wpf-passwordbox-and-data-binding.html" target="_blank">отсюда</a> (учтите это небезопасное решение, не просто так PasswordBox сделали без возможности устанавливать Binding на поле Password). Задача по сбору статистики работает отдельным потоком, опять таки при помощи моего <a href="http://www.gotdotnet.ru/blogs/outcoldman/6607/" target="_blank">любимого</a> <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx" target="_blank">BackgroundWorker</a>. Ну а сохранение скриншота программы стало возможно благодаря вот <a href="http://blogs.msdn.com/kirillosenkov/archive/2009/10/12/saving-images-bmp-png-etc-in-wpf-silverlight.aspx" target="_blank">этой</a> заметке. </p>  <p>Разбивал на слова я так:</p>  

<pre><code>string[] words = tweet.Text.Split(new[] {' ', '.', ',', '?', '!'}, StringSplitOptions.RemoveEmptyEntries);</code></pre>

<p>Потому если этих наборов символов вам не хватит – добавьте свои. ‘)’ и ‘(’ я использоваться не стал, сейчас думаю, что надо было бы еще добавить ‘-‘, наверное. При считывании твиттов, программа их складывает так же в лог рядом с собой по дате. Это на случай – если хочется посмотреть действительно ли это ваш твиттер.</p>
<p>В целом код там достаточно простой. Изначально я даже подумал добавить туда БД (Compact) для истории твиттов, чтобы второй раз уже не скачивать, так же сделать возможность поиска по скаченным твиттам, ну и еще какие то задумки… Но пока оставлю так, если у кого то есть желание что то подправить – код там прост и понятен – правьте. Вносите предложения, может в будущем и еще что то добавлю, если будет спрос. Удачи!</p>
<h4>Ссылки</h4>
<ul>
  <li><a href="/library/content/01/TwitterCloud%201.0%20bin.zip" target="_blank">TwitterCloud 1.0 bin.zip</a> </li>

  <li><a href="/library/content/01/TwitterCloud%201.0%20src.zip" target="_blank">TwitterCloud 1.0 src.zip</a> </li>
</ul>
<p>
</p>
