---
layout: post
title: "Outcold.SiteManager в действии"
date: 2009-04-05 10:42:00
categories: ru
tags: [ASP.NET, comilfoav.ru]
permalink: ru/blog/show/133
---
<p>Как я и <a href="/ru/blog/show/132">обещал</a>, что если будут заинтересованные лица, то я выложу код (пример сайта), при помощи которого работает <a href="http://comilfoav.ru">http://comilfoav.ru</a>.</p>    <p>Итак <a href="/library/content/01/sitemanager.zip">ссылка на скачивание</a>. Проект от Visual Studio 2008 SP1. Дизайн полностью убран. Функциональность обрезана. Оставлены только основные примеры (каталог, items и статистика)</p>    <p></p>    <p>Теперь об установке:<ul><li>Распаковываем архив</li><li>Из архива восстанавливаем базу SMSample.bak на ваш сервер SQL</li><li>Открываем web.config для настроек:</li></ul><ol><li>Первые 5 настроек appconfig указывают на xml файлы настроек сайта (rewriter, messages, menu и т.д.)</li><li>LogAdminSteps - записывать ли статистику, если пользователь аутентифицирован</li><li>NeedStatistic - необходимо ли записывать статистику в базу (число посещений и другое)</li><li>WGLicenseKey - ключ для <a href="http://www.webgrid.com/">WebGrid </a>(иначе не будет работать) - <a href="http://www.webgrid.com/examples/requestlicense.aspx">взять на официальном сайте бесплатно</a>.</li><li>connectionStrings под именем Main - строка подключения к базе данных (восстановленной базе из бекапа)</li><li>в секции authentication есть пользовать admin - admin для административной части приложения (здесь вы можете менять пароль или добавлять других пользователей).</li></ol><ul><li>В папке ImgLibrary самого сайта находятся папки для хранения картинок, где FCKLibrary - папка где хранятся картинки от fckeditor, Firm - картинки от фирм, Item - картинки от item.</li><li>Папка images содержит картинки для WebGrid (не работает он нормально, если положить их в другое место).</li><li>Сайт лучше запускать на IIS сервере (на сервере от VS он тоже будет работать, но не проверялся)</li></ul>Пару слов о siteitems.config, он как раз и содержит mapping url путей к физическим путям сайта. В <em><strong>Configuration</strong></em> <em><span style="color: rgb(255, 153, 0);">Extension </span></em>- указывает какие типы файлов (расширений) нужно перехватывать, <em><span style="color: rgb(255, 153, 0);">Separator </span></em>- указывают чем разделены Folder в url (<em>catalog/items/10.aspx</em> - в этом случае <em>catalog </em>и <em>items </em>- Folders, а 10 - Item).</p>    <p>Дальше файл описывают структуру сайта при помощи понятий folder и item. </p>    <p></p>    <p>У <strong><em>Folder </em></strong>и <strong><em>Item </em></strong>есть следующие аттрибуты:</p>    <p><em><span style="color: rgb(255, 102, 0);">Id </span></em>- просто уникальное имя объекта (чтобы его можно было найти);</p>    <p><em><span style="color: rgb(255, 153, 0);">Pattern </span></em>- <a href="http://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%B3%D1%83%D0%BB%D1%8F%D1%80%D0%BD%D1%8B%D0%B5_%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F">регулярное выражение</a>, указывающее что в url представляет данный объект.</p>    <p>У обоих элементов xml могут быть вложенные элементы:</p>    <p><em><span style="color: rgb(255, 153, 0);">User </span></em>- имя пользователя, под которым могут заходить в данный <em>folder </em>или <em>item</em>;</p>    <p><em><span style="color: rgb(255, 153, 0);">ContextParameter </span></em>- параметр, в который будет преобразован url данного элемента (для обозначения идентификаторов, например), которые можно запросто получить в code behind при помощи класса <span style="color: rgb(51, 204, 204);"><em>HttpContextHelper (outcold.sitemanager)</em></span>;</p>    <p><em><span style="color: rgb(255, 153, 0);">Parameter </span></em>- фиксированный параметр данного item (получить значение можно опять при помощи <span style="color: rgb(51, 204, 204);"><em>HttpContextHelper</em></span>).</p>    <p></p>    <p>У <strong><em>Item </em></strong>есть атрибуты, помимо выше перечисленных:</p>    <p><em><span style="color: rgb(255, 153, 0);">Location </span></em>- физический путь к странице;</p>    <p><em><span style="color: rgb(255, 153, 0);">Title</span></em> - заголовок страницы.</p>    <p>Чтобы работать с элементами xml файла siteitems.config - существует класс <em><span style="color: rgb(51, 204, 204);">NavigationManager</span></em>, так чтобы получить url какого то либо item необходим метод <em><span style="color: rgb(51, 204, 204);">NavigationManager.GetUrl</span></em>, у которого первый параметр обозначает id элемента в xml, а следующие - подставляемые значения в contextparameters (их может и не быть).</p>    <p></p>    <p>Вот такой вот, по моему мнению, не сложный конфигуратор. Пробуйте пример и задавайте вопросы. </p>
